<!-- Pagination -->
<div
  class="flex items-center min-w-full justify-center border-b border-gray-200 bg-white px-4 py-3 mt-5 sm:px-6"
>
  <div
    class="hidden items-center justify-center sm:flex sm:flex-1 sm:items-center sm:justify-between"
  >
    <div class="flex items-center justify-center min-w-full">
      <nav
        class="isolate inline-flex -space-x-px rounded-md shadow-sm"
        aria-label="Pagination"
      >
        {% if page_obj.has_previous %}
            <a
            href="?page={{ page_obj.previous_page_number }}"
            class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20"
            >
            <span class="sr-only">Previous</span>
            <svg
                class="size-5"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
            >
                <path
                fill-rule="evenodd"
                d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                clip-rule="evenodd"
                />
            </svg>
            </a>
        {% endif %}

        <!-- Always show first 1-3 pages -->
        {% for page_num in page_obj.paginator.page_range %}
            {% if page_num <= 3 %}
                <a
                href="?page={{ page_num }}"
                class="relative inline-flex items-center px-4 py-2 text-sm font-semibold {% if page_num == page_obj.number %}bg-indigo-600 text-white{% else %}text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50{% endif %}"
                >
                {{ page_num }}
                </a>
            {% endif %}
        {% endfor %}

        <!-- Ellipsis after first 3 pages if current page is greater than 4 -->
        {% if page_obj.number > 4 %}
            <span
            class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300"
            >
            ...
            </span>
        {% endif %}

        <!-- Centered dynamic pages (show +/- 2 pages around the current one) -->
        {% for page_num in page_obj.paginator.page_range %}
            {% if page_num >= page_obj.number|add:'-2' and page_num <= page_obj.number|add:'2' and page_num > 3 and page_num < page_obj.paginator.num_pages|add:'-2' %}
                <a
                href="?page={{ page_num }}"
                class="relative inline-flex items-center px-4 py-2 text-sm font-semibold {% if page_num == page_obj.number %}bg-indigo-600 text-white{% else %}text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50{% endif %}"
                >
                {{ page_num }}
                </a>
            {% endif %}
        {% endfor %}

        <!-- Ellipsis before last few pages (if not near the end) -->
        {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
            <span
            class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300"
            >
            ...
            </span>
        {% endif %}

        <!-- Always show last 3 pages -->
        {% for page_num in page_obj.paginator.page_range %}
            {% if page_num > page_obj.paginator.num_pages|add:'-2' %}
                <a
                href="?page={{ page_num }}"
                class="relative inline-flex items-center px-4 py-2 text-sm font-semibold {% if page_num == page_obj.number %}bg-indigo-600 text-white{% else %}text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50{% endif %}"
                >
                {{ page_num }}
                </a>
            {% endif %}
        {% endfor %}
        {% if page_obj.has_next %}
            <a
            href="?page={{ page_obj.next_page_number }}"
            class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20"
            >
            <span class="sr-only">Next</span>
            <svg
                class="size-5"
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
            >
                <path
                fill-rule="evenodd"
                d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z"
                clip-rule="evenodd"
                />
            </svg>
            </a>
        {% endif %}
      </nav>
    </div>
  </div>
</div>
<!-- End of Pagination -->
